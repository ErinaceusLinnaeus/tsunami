// Image = hui:properties
// Title[Deutsch] = Verzerrer
use "../../api.kaba"

const string AutoConfigGain = "0:1:0.1:100:%"

class Config : PluginData
	float Gain
	overwrite void reset()
		Gain = 0.1

class Distortion : AudioEffect
	Config config


	overwrite void process(BufferBox buf)
		float a = max(10000 * pow(config.Gain, 2), 0.01)
		float b = 1 / atan(a)
	
		for i in 0:buf.num
			buf.r[i] = b * atan(buf.r[i] * a)
			buf.l[i] = b * atan(buf.l[i] * a)
