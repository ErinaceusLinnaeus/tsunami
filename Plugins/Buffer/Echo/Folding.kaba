use "../../api.kaba"

void fold(float[] b, float[] k)
	float[] o
	o.resize(b.num)
	
	int n = 50000
	for bb,i in b
		if (i % 1000) == 0
			print i
		o[i] = bb
		for j in 0:n
			if i >= j
				o[i] += b[i - j] * k[j] * 0.07
	b = o

class Folding : AudioEffect
	overwrite void process(BufferBox buf)
		fold(buf.r, song.tracks[0].levels[0].buffers[0].r)
		fold(buf.l, song.tracks[0].levels[0].buffers[0].l)
	