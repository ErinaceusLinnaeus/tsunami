
project('tsunami', 'cpp', default_options : ['cpp_std=c++14', 'warning_level=1'])
add_project_arguments('-O2', '-g', '-Wno-unused', '-Wstrict-aliasing=0', '-fno-omit-frame-pointer', language : ['cpp'])

#install_data
#meson.add_install_script('')
#install_subdir


cc = meson.get_compiler('cpp')

# mandatory dependencies
mdep = cc.find_library('m', required : false)
gtkdep = dependency('gtk+-3.0')
add_project_arguments('-DHAS_LIB_GTK3=1', language : ['cpp'])
threaddep = dependency('threads')
zdep = dependency('zlib')
add_project_arguments('-DHAS_LIB_ZLIB=1', language : ['cpp'])
fftwdep = cc.find_library('fftw3f')
add_project_arguments('-DHAS_LIB_FFTW3=1', language : ['cpp'])
deps = [mdep, gtkdep, threaddep, zdep, fftwdep]


# optional dependencies
libs_optional = {
	'DL':['dl'],
	'OGG':['ogg', 'vorbis', 'vorbisfile', 'vorbisenc'],
	'FLAC':['FLAC'],
	'ALSA':['asound'],
	'PULSEAUDIO':['pulse'],
	'PORTAUDIO':['portaudio'],
	'UNWIND':['unwind']}
foreach name, libs : libs_optional
	found = true
	dd = []
	foreach l : libs
		d = cc.find_library(l, required : false)
		dd += [d]
		if not d.found()
			found = false
		endif
	endforeach
	if found
		add_project_arguments('-DHAS_LIB_' + name + '=1', language : ['cpp'])
		deps += dd
	else
		add_project_arguments('-DHAS_LIB_' + name + '=0', language : ['cpp'])
	endif
endforeach

sources = ['Action/Bar/Action__ScaleData.cpp',
	'Action/Bar/Action__ShiftData.cpp',
	'Action/Bar/ActionBar__Add.cpp',
	'Action/Bar/ActionBar__Delete.cpp',
	'Action/Bar/ActionBar__Edit.cpp',
	'Action/Bar/ActionBarAdd.cpp',
	'Action/Bar/ActionBarDelete.cpp',
	'Action/Bar/ActionBarEdit.cpp',
	'Action/Curve/ActionCurveAdd.cpp',
	'Action/Curve/ActionCurveAddPoint.cpp',
	'Action/Curve/ActionCurveDelete.cpp',
	'Action/Curve/ActionCurveDeletePoint.cpp',
	'Action/Curve/ActionCurveEdit.cpp',
	'Action/Curve/ActionCurveEditPoint.cpp',
	'Action/Sample/ActionSampleAdd.cpp',
	'Action/Sample/ActionSampleDelete.cpp',
	'Action/Sample/ActionSampleEditName.cpp',
	'Action/Sample/ActionSampleScale.cpp',
	'Action/Song/Data/ActionSongChangeAllTrackVolumes.cpp',
	'Action/Song/Data/ActionSongSetDefaultFormat.cpp',
	'Action/Song/Data/ActionSongSetSampleRate.cpp',
	'Action/Song/Data/ActionSongSetVolume.cpp',
	'Action/Song/ActionSongDeleteSelection.cpp',
	'Action/Song/ActionSongMoveSelection.cpp',
	'Action/Tag/ActionTagAdd.cpp',
	'Action/Tag/ActionTagDelete.cpp',
	'Action/Tag/ActionTagEdit.cpp',
	'Action/Track/Buffer/ActionTrack__AbsorbBuffer.cpp',
	'Action/Track/Buffer/ActionTrack__AddBuffer.cpp',
	'Action/Track/Buffer/ActionTrack__BufferSetChannels.cpp',
	'Action/Track/Buffer/ActionTrack__DeleteBuffer.cpp',
	'Action/Track/Buffer/ActionTrack__GrowBuffer.cpp',
	'Action/Track/Buffer/ActionTrack__ShrinkBuffer.cpp',
	'Action/Track/Buffer/ActionTrack__SplitBuffer.cpp',
	'Action/Track/Buffer/ActionTrackCreateBuffers.cpp',
	'Action/Track/Buffer/ActionTrackEditBuffer.cpp',
	'Action/Track/Buffer/ActionTrackSetChannels.cpp',
	'Action/Track/Data/ActionTrackEditMuted.cpp',
	'Action/Track/Data/ActionTrackEditName.cpp',
	'Action/Track/Data/ActionTrackEditPanning.cpp',
	'Action/Track/Data/ActionTrackEditVolume.cpp',
	'Action/Track/Data/ActionTrackSetInstrument.cpp',
	'Action/Track/Effect/ActionTrackAddAudioEffect.cpp',
	'Action/Track/Effect/ActionTrackDeleteEffect.cpp',
	'Action/Track/Effect/ActionTrackEditAudioEffect.cpp',
	'Action/Track/Effect/ActionTrackMoveAudioEffect.cpp',
	'Action/Track/Effect/ActionTrackToggleAudioEffectEnabled.cpp',
	'Action/Track/Layer/ActionTrackFadeAdd.cpp',
	'Action/Track/Layer/ActionTrackFadeDelete.cpp',
	'Action/Track/Layer/ActionTrackLayer__Delete.cpp',
	'Action/Track/Layer/ActionTrackLayerAdd.cpp',
	'Action/Track/Layer/ActionTrackLayerDelete.cpp',
	'Action/Track/Layer/ActionTrackLayerMakeTrack.cpp',
	'Action/Track/Layer/ActionTrackLayerMarkDominant.cpp',
	'Action/Track/Layer/ActionTrackLayerMerge.cpp',
	'Action/Track/Layer/ActionTrackLayerMove.cpp',
	'Action/Track/Marker/ActionTrackAddMarker.cpp',
	'Action/Track/Marker/ActionTrackDeleteMarker.cpp',
	'Action/Track/Marker/ActionTrackEditMarker.cpp',
	'Action/Track/Midi/ActionTrackAddMidiEffect.cpp',
	'Action/Track/Midi/ActionTrackAddMidiNote.cpp',
	'Action/Track/Midi/ActionTrackDeleteMidiEffect.cpp',
	'Action/Track/Midi/ActionTrackDeleteMidiNote.cpp',
	'Action/Track/Midi/ActionTrackEditMidiEffect.cpp',
	'Action/Track/Midi/ActionTrackEditMidiNote.cpp',
	'Action/Track/Midi/ActionTrackInsertMidi.cpp',
	'Action/Track/Midi/ActionTrackToggleMidiEffectEnabled.cpp',
	'Action/Track/Sample/ActionTrackAddSample.cpp',
	'Action/Track/Sample/ActionTrackDeleteSample.cpp',
	'Action/Track/Sample/ActionTrackEditSample.cpp',
	'Action/Track/Sample/ActionTrackInsertSample.cpp',
	'Action/Track/Sample/ActionTrackInsertSelectedSamples.cpp',
	'Action/Track/Sample/ActionTrackPasteAsSample.cpp',
	'Action/Track/Sample/ActionTrackSampleFromSelection.cpp',
	'Action/Track/Synthesizer/ActionTrackDetuneSynthesizer.cpp',
	'Action/Track/Synthesizer/ActionTrackEditSynthesizer.cpp',
	'Action/Track/Synthesizer/ActionTrackSetSynthesizer.cpp',
	'Action/Track/ActionTrack__DeleteEmpty.cpp',
	'Action/Track/ActionTrackAdd.cpp',
	'Action/Track/ActionTrackDelete.cpp',
	'Action/Track/ActionTrackMove.cpp',
	'Action/Action.cpp',
	'Action/ActionGroup.cpp',
	'Action/ActionManager.cpp',
	'Action/ActionMergable.cpp',
	'Data/Audio/AudioBuffer.cpp',
	'Data/Audio/BufferInterpolator.cpp',
	'Data/Audio/RingBuffer.cpp',
	'Data/Midi/Clef.cpp',
	'Data/Midi/Instrument.cpp',
	'Data/Midi/MidiData.cpp',
	'Data/Midi/MidiEvent.cpp',
	'Data/Midi/MidiNote.cpp',
	'Data/Midi/Scale.cpp',
	'Data/Rhythm/Bar.cpp',
	'Data/Rhythm/BarCollection.cpp',
	'Data/Rhythm/Beat.cpp',
	'Data/base.cpp',
	'Data/CrossFade.cpp',
	'Data/Curve.cpp',
	'Data/Data.cpp',
	'Data/Range.cpp',
	'Data/Sample.cpp',
	'Data/SampleRef.cpp',
	'Data/Song.cpp',
	'Data/SongSelection.cpp',
	'Data/Track.cpp',
	'Data/TrackLayer.cpp',
	'Data/TrackMarker.cpp',
	'Device/Device.cpp',
	'Device/DeviceManager.cpp',
	'lib/base/array.cpp',
	'lib/base/strings.cpp',
	'lib/file/file.cpp',
	'lib/file/file_op.cpp',
	'lib/file/msg.cpp',
	'lib/hui/Controls/Control.cpp',
	'lib/hui/Controls/ControlButtonGtk.cpp',
	'lib/hui/Controls/ControlCheckBoxGtk.cpp',
	'lib/hui/Controls/ControlColorButtonGtk.cpp',
	'lib/hui/Controls/ControlComboBoxGtk.cpp',
	'lib/hui/Controls/ControlDrawingAreaGtk.cpp',
	'lib/hui/Controls/ControlEditGtk.cpp',
	'lib/hui/Controls/ControlExpanderGtk.cpp',
	'lib/hui/Controls/ControlGridGtk.cpp',
	'lib/hui/Controls/ControlGroupGtk.cpp',
	'lib/hui/Controls/ControlLabelGtk.cpp',
	'lib/hui/Controls/ControlListViewGtk.cpp',
	'lib/hui/Controls/ControlMenuButtonGtk.cpp',
	'lib/hui/Controls/ControlMultilineEditGtk.cpp',
	'lib/hui/Controls/ControlPanedGtk.cpp',
	'lib/hui/Controls/ControlProgressBarGtk.cpp',
	'lib/hui/Controls/ControlRadioButtonGtk.cpp',
	'lib/hui/Controls/ControlRevealerGtk.cpp',
	'lib/hui/Controls/ControlScrollerGtk.cpp',
	'lib/hui/Controls/ControlSeparatorGtk.cpp',
	'lib/hui/Controls/ControlSliderGtk.cpp',
	'lib/hui/Controls/ControlSpinButtonGtk.cpp',
	'lib/hui/Controls/ControlTabControlGtk.cpp',
	'lib/hui/Controls/ControlToggleButtonGtk.cpp',
	'lib/hui/Controls/ControlTreeViewGtk.cpp',
	'lib/hui/Controls/MenuItemGtk.cpp',
	'lib/hui/Controls/MenuItemSeparatorGtk.cpp',
	'lib/hui/Controls/MenuItemSeparatorWin.cpp',
	'lib/hui/Controls/MenuItemSubmenuGtk.cpp',
	'lib/hui/Controls/MenuItemSubmenuWin.cpp',
	'lib/hui/Controls/MenuItemToggleGtk.cpp',
	'lib/hui/Controls/MenuItemToggleWin.cpp',
	'lib/hui/Controls/MenuItemWin.cpp',
	'lib/hui/Controls/ToolItemButtonGtk.cpp',
	'lib/hui/Controls/ToolItemButtonWin.cpp',
	'lib/hui/Controls/ToolItemMenuButtonGtk.cpp',
	'lib/hui/Controls/ToolItemMenuButtonWin.cpp',
	'lib/hui/Controls/ToolItemSeparatorGtk.cpp',
	'lib/hui/Controls/ToolItemSeparatorWin.cpp',
	'lib/hui/Controls/ToolItemToggleButtonGtk.cpp',
	'lib/hui/Controls/ToolItemToggleButtonWin.cpp',
	'lib/hui/Application.cpp',
	'lib/hui/Callback.cpp',
	'lib/hui/Clipboard.cpp',
	'lib/hui/common_dlg.cpp',
	'lib/hui/common_dlg_gtk.cpp',
	'lib/hui/common_dlg_win.cpp',
	'lib/hui/Config.cpp',
	'lib/hui/error.cpp',
	'lib/hui/Event.cpp',
	'lib/hui/hui.cpp',
	'lib/hui/language.cpp',
	'lib/hui/main_gtk.cpp',
	'lib/hui/main_win.cpp',
	'lib/hui/Menu.cpp',
	'lib/hui/MenuGtk.cpp',
	'lib/hui/MenuWin.cpp',
	'lib/hui/PainterGtk.cpp',
	'lib/hui/Panel.cpp',
	'lib/hui/Resource.cpp',
	'lib/hui/Timer.cpp',
	'lib/hui/Toolbar.cpp',
	'lib/hui/ToolbarGtk.cpp',
	'lib/hui/ToolbarWin.cpp',
	'lib/hui/utility.cpp',
	'lib/hui/Window.cpp',
	'lib/hui/window_control.cpp',
	'lib/hui/window_control_gtk.cpp',
	'lib/hui/window_control_win.cpp',
	'lib/hui/WindowGtk.cpp',
	'lib/hui/WindowWin.cpp',
	'lib/image/color.cpp',
	'lib/image/image.cpp',
	'lib/image/image_bmp.cpp',
	'lib/image/image_jpg.cpp',
	'lib/image/image_png.cpp',
	'lib/image/image_tga.cpp',
	'lib/image/ImagePainter.cpp',
	'lib/kaba/asm/asm.cpp',
	'lib/kaba/compiler/compiler.cpp',
	'lib/kaba/compiler/mapper.cpp',
	'lib/kaba/compiler/serializer.cpp',
	'lib/kaba/compiler/serializer_amd64.cpp',
	'lib/kaba/compiler/serializer_arm.cpp',
	'lib/kaba/compiler/serializer_x86.cpp',
	'lib/kaba/lib/exception.cpp',
	'lib/kaba/lib/lib.cpp',
	'lib/kaba/lib/lib_file.cpp',
	'lib/kaba/lib/lib_hui.cpp',
	'lib/kaba/lib/lib_image.cpp',
	'lib/kaba/lib/lib_math.cpp',
	'lib/kaba/lib/lib_net.cpp',
	'lib/kaba/lib/lib_nix.cpp',
	'lib/kaba/lib/lib_sound.cpp',
	'lib/kaba/lib/lib_threads.cpp',
	'lib/kaba/lib/lib_x.cpp',
	'lib/kaba/syntax/Class.cpp',
	'lib/kaba/syntax/Constant.cpp',
	'lib/kaba/syntax/Function.cpp',
	'lib/kaba/syntax/implicit.cpp',
	'lib/kaba/syntax/lexical.cpp',
	'lib/kaba/syntax/Node.cpp',
	'lib/kaba/syntax/parser.cpp',
	'lib/kaba/syntax/Parser.cpp',
	'lib/kaba/syntax/precompiler.cpp',
	'lib/kaba/syntax/preprocessor.cpp',
	'lib/kaba/syntax/SyntaxTree.cpp',
	'lib/kaba/kaba.cpp',
	'lib/math/complex.cpp',
	'lib/math/interpolation.cpp',
	'lib/math/math.cpp',
	'lib/math/matrix.cpp',
	'lib/math/matrix3.cpp',
	'lib/math/plane.cpp',
	'lib/math/quaternion.cpp',
	'lib/math/random.cpp',
	'lib/math/ray.cpp',
	'lib/math/rect.cpp',
	'lib/math/vector.cpp',
	'lib/net/net.cpp',
	'lib/threads/Mutex.cpp',
	'lib/threads/Thread.cpp',
	'lib/threads/ThreadedWork.cpp',
	'lib/xfile/chunked.cpp',
	'lib/xfile/pdf.cpp',
	'lib/xfile/xml.cpp',
	'Module/Audio/AudioBackup.cpp',
	'Module/Audio/AudioEffect.cpp',
	'Module/Audio/AudioJoiner.cpp',
	'Module/Audio/AudioRecorder.cpp',
	'Module/Audio/AudioSource.cpp',
	'Module/Audio/AudioSucker.cpp',
	'Module/Audio/AudioVisualizer.cpp',
	'Module/Audio/BufferStreamer.cpp',
	'Module/Audio/PeakMeter.cpp',
	'Module/Audio/PitchDetector.cpp',
	'Module/Audio/SongRenderer.cpp',
	'Module/Audio/TrackRenderer.cpp',
	'Module/Beats/BarStreamer.cpp',
	'Module/Beats/BeatMidifier.cpp',
	'Module/Beats/BeatSource.cpp',
	'Module/Midi/MidiEffect.cpp',
	'Module/Midi/MidiEventStreamer.cpp',
	'Module/Midi/MidiRecorder.cpp',
	'Module/Midi/MidiSource.cpp',
	'Module/Midi/MidiSucker.cpp',
	'Module/Port/Port.cpp',
	'Module/Synth/DummySynthesizer.cpp',
	'Module/Synth/EnvelopeADSR.cpp',
	'Module/Synth/SampleSynthesizer.cpp',
	'Module/Synth/Synthesizer.cpp',
	'Module/AutoConfigPanel.cpp',
	'Module/ConfigPanel.cpp',
	'Module/Module.cpp',
	'Module/ModuleConfiguration.cpp',
	'Module/ModuleFactory.cpp',
	'Module/SignalChain.cpp',
	'Plugins/ExtendedAudioBuffer.cpp',
	'Plugins/FastFourierTransform.cpp',
	'Plugins/FavoriteManager.cpp',
	'Plugins/Plugin.cpp',
	'Plugins/PluginManager.cpp',
	'Plugins/SongPlugin.cpp',
	'Plugins/TsunamiPlugin.cpp',
	'Storage/Dialog/PdfConfigDialog.cpp',
	'Storage/Dialog/RawConfigDialog.cpp',
	'Storage/Format/Format.cpp',
	'Storage/Format/FormatFlac.cpp',
	'Storage/Format/FormatGuitarPro.cpp',
	'Storage/Format/FormatM4a.cpp',
	'Storage/Format/FormatMidi.cpp',
	'Storage/Format/FormatMp3.cpp',
	'Storage/Format/FormatNami.cpp',
	'Storage/Format/FormatOgg.cpp',
	'Storage/Format/FormatPdf.cpp',
	'Storage/Format/FormatRaw.cpp',
	'Storage/Format/FormatSoundFont2.cpp',
	'Storage/Format/FormatWave.cpp',
	'Storage/Storage.cpp',
	'Storage/StorageOperationData.cpp',
	'Stream/AudioInput.cpp',
	'Stream/AudioOutput.cpp',
	'Stream/MidiInput.cpp',
	'Stuff/BackupManager.cpp',
	'Stuff/Clipboard.cpp',
	'Stuff/Log.cpp',
	'Stuff/Observable.cpp',
	'Stuff/PerformanceMonitor.cpp',
	'Test/TestAudioBuffer.cpp',
	'Test/TestMidiPreview.cpp',
	'Test/TestPlugins.cpp',
	'Test/TestRhythm.cpp',
	'Test/TestStreams.cpp',
	'Test/TestThreads.cpp',
	'Test/UnitTest.cpp',
	'View/BottomBar/BottomBar.cpp',
	'View/BottomBar/DeviceConsole.cpp',
	'View/BottomBar/LogConsole.cpp',
	'View/BottomBar/MiniBar.cpp',
	'View/BottomBar/MixingConsole.cpp',
	'View/BottomBar/PluginConsole.cpp',
	'View/BottomBar/SignalEditor.cpp',
	'View/Dialog/BarAddDialog.cpp',
	'View/Dialog/BarDeleteDialog.cpp',
	'View/Dialog/BarEditDialog.cpp',
	'View/Dialog/ConfigurableSelectorDialog.cpp',
	'View/Dialog/DetuneSynthesizerDialog.cpp',
	'View/Dialog/MarkerDialog.cpp',
	'View/Dialog/NewDialog.cpp',
	'View/Dialog/PauseAddDialog.cpp',
	'View/Dialog/PauseEditDialog.cpp',
	'View/Dialog/SampleScaleDialog.cpp',
	'View/Dialog/SettingsDialog.cpp',
	'View/Dialog/TuningDialog.cpp',
	'View/Helper/CpuDisplay.cpp',
	'View/Helper/MidiPreview.cpp',
	'View/Helper/PeakMeterDisplay.cpp',
	'View/Helper/Progress.cpp',
	'View/Helper/ScrollBar.cpp',
	'View/Helper/Slider.cpp',
	'View/Helper/SymbolRenderer.cpp',
	'View/Mode/ViewMode.cpp',
	'View/Mode/ViewModeCapture.cpp',
	'View/Mode/ViewModeCurve.cpp',
	'View/Mode/ViewModeDefault.cpp',
	'View/Mode/ViewModeMidi.cpp',
	'View/Mode/ViewModeScaleBars.cpp',
	'View/Painter/BufferPainter.cpp',
	'View/Painter/GridPainter.cpp',
	'View/Painter/MidiPainter.cpp',
	'View/SideBar/CaptureConsoleModes/CaptureConsoleMode.cpp',
	'View/SideBar/CaptureConsoleModes/CaptureConsoleModeAudio.cpp',
	'View/SideBar/CaptureConsoleModes/CaptureConsoleModeMidi.cpp',
	'View/SideBar/CaptureConsoleModes/CaptureConsoleModeMulti.cpp',
	'View/SideBar/CaptureConsole.cpp',
	'View/SideBar/CurveConsole.cpp',
	'View/SideBar/FxConsole.cpp',
	'View/SideBar/MidiEditorConsole.cpp',
	'View/SideBar/MidiFxConsole.cpp',
	'View/SideBar/SampleManagerConsole.cpp',
	'View/SideBar/SampleRefConsole.cpp',
	'View/SideBar/SideBar.cpp',
	'View/SideBar/SongConsole.cpp',
	'View/SideBar/SynthConsole.cpp',
	'View/SideBar/TrackConsole.cpp',
	'View/AudioView.cpp',
	'View/AudioViewLayer.cpp',
	'View/AudioViewTrack.cpp',
	'View/ColorScheme.cpp',
	'View/Selection.cpp',
	'View/TrackHeightManager.cpp',
	'View/ViewPort.cpp',
	'Session.cpp',
	'Tsunami.cpp',
	'TsunamiWindow.cpp']

executable('tsunami', sources, dependencies : deps, install : true)
